<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Hours Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-react/0.263.1/lucide-react.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Plus, Clock, Calendar, Trash2, CheckCircle, AlertCircle, Download, Upload, Save } = lucideReact;

        function TimeTracker() {
            const [entries, setEntries] = useState([]);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [loading, setLoading] = useState(true);
            const fileInputRef = useRef(null);
            
            const [newEntry, setNewEntry] = useState({
                category: '',
                description: '',
                hours: ''
            });

            const categories = [
                'Development',
                'Meetings',
                'Training',
                'PTO',
                'Testing',
                'Documentation',
                'Support',
                'Planning'
            ];

            // Cargar datos del localStorage al iniciar
            useEffect(() => {
                try {
                    const savedEntries = localStorage.getItem('timeTrackerEntries');
                    if (savedEntries) {
                        setEntries(JSON.parse(savedEntries));
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            }, []);

            // Guardar datos en localStorage cada vez que entries cambie
            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('timeTrackerEntries', JSON.stringify(entries));
                    } catch (error) {
                        console.error('Error saving data:', error);
                    }
                }
            }, [entries, loading]);

            const addEntry = () => {
                if (newEntry.category && newEntry.description && newEntry.hours) {
                    const entry = {
                        id: Date.now(),
                        date: selectedDate,
                        category: newEntry.category,
                        description: newEntry.description,
                        hours: parseFloat(newEntry.hours),
                        timestamp: new Date().toISOString()
                    };
                    
                    setEntries([...entries, entry]);
                    setNewEntry({ category: '', description: '', hours: '' });
                }
            };

            const deleteEntry = (id) => {
                setEntries(entries.filter(entry => entry.id !== id));
            };

            const getEntriesForDate = (date) => {
                return entries.filter(entry => entry.date === date);
            };

            const getTotalHoursForDate = (date) => {
                return getEntriesForDate(date).reduce((total, entry) => total + entry.hours, 0);
            };

            const getUniqueWorkDates = () => {
                const dates = [...new Set(entries.map(entry => entry.date))];
                return dates.sort().reverse();
            };

            // Funciones para exportar/importar datos (respaldo)
            const exportData = () => {
                const dataToExport = {
                    entries: entries,
                    exportDate: new Date().toISOString(),
                    version: "1.0"
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `work-hours-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData.entries && Array.isArray(importedData.entries)) {
                                const existingIds = new Set(entries.map(entry => entry.id));
                                const newEntries = importedData.entries.filter(entry => !existingIds.has(entry.id));
                                setEntries([...entries, ...newEntries]);
                                alert(`✅ Data imported successfully. Added ${newEntries.length} new records.`);
                            } else {
                                alert('❌ Invalid file format');
                            }
                        } catch (error) {
                            alert('❌ Error reading file');
                        }
                    };
                    reader.readAsText(file);
                }
                event.target.value = '';
            };

            const todayEntries = getEntriesForDate(selectedDate);
            const totalHours = getTotalHoursForDate(selectedDate);
            const workDates = getUniqueWorkDates();

            if (loading) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gray-50">
                        <div className="text-center">
                            <Clock className="w-12 h-12 text-blue-600 mx-auto mb-4 loading" />
                            <p className="text-gray-600">Loading your data...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-4xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-6">
                            <div className="flex items-center gap-3 mb-4 sm:mb-0">
                                <Clock className="w-8 h-8 text-blue-600" />
                                <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">Work Hours Tracker</h1>
                            </div>
                            
                            {/* Botones de respaldo */}
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={exportData}
                                    className="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center gap-2 text-sm"
                                    title="Export backup"
                                >
                                    <Download className="w-4 h-4" />
                                    Backup
                                </button>
                                
                                <input
                                    type="file"
                                    ref={fileInputRef}
                                    onChange={importData}
                                    accept=".json"
                                    className="hidden"
                                />
                                
                                <button
                                    onClick={() => fileInputRef.current?.click()}
                                    className="px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 flex items-center gap-2 text-sm"
                                    title="Restore backup"
                                >
                                    <Upload className="w-4 h-4" />
                                    Restore
                                </button>
                            </div>
                        </div>

                        {/* Indicador de guardado automático */}
                        <div className="bg-green-50 border border-green-200 rounded-lg p-3 mb-6">
                            <div className="flex items-center gap-2">
                                <CheckCircle className="w-4 h-4 text-green-600" />
                                <span className="text-sm text-green-700 font-medium">
                                    ✅ Auto-save enabled - Your data syncs across devices
                                </span>
                            </div>
                        </div>

                        {/* Selector de fecha */}
                        <div className="mb-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                <Calendar className="w-4 h-4 inline mr-2" />
                                Work date
                            </label>
                            <input
                                type="date"
                                value={selectedDate}
                                onChange={(e) => setSelectedDate(e.target.value)}
                                className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>

                        {/* Formulario para agregar entrada */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select
                                    value={newEntry.category}
                                    onChange={(e) => setNewEntry({...newEntry, category: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="">Select...</option>
                                    {categories.map(cat => (
                                        <option key={cat} value={cat}>{cat}</option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Description/Ticket</label>
                                <input
                                    type="text"
                                    placeholder="e.g: TAM-299, project meeting..."
                                    value={newEntry.description}
                                    onChange={(e) => setNewEntry({...newEntry, description: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Hours</label>
                                <input
                                    type="number"
                                    step="0.5"
                                    min="0"
                                    max="8"
                                    placeholder="1.5"
                                    value={newEntry.hours}
                                    onChange={(e) => setNewEntry({...newEntry, hours: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>

                            <div className="flex items-end">
                                <button
                                    onClick={addEntry}
                                    className="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center justify-center gap-2"
                                >
                                    <Plus className="w-4 h-4" />
                                    Add
                                </button>
                            </div>
                        </div>

                        {/* Resumen del día actual */}
                        <div className={`p-4 rounded-lg mb-6 ${totalHours === 8 ? 'bg-green-50 border border-green-200' : totalHours > 8 ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'}`}>
                            <div className="flex items-center gap-2 mb-2">
                                {totalHours === 8 ? (
                                    <CheckCircle className="w-5 h-5 text-green-600" />
                                ) : (
                                    <AlertCircle className="w-5 h-5 text-yellow-600" />
                                )}
                                <h3 className="font-semibold text-lg">
                                    {selectedDate === new Date().toISOString().split('T')[0] ? 'Today' : selectedDate}: {totalHours}/8 hours
                                </h3>
                            </div>
                            
                            {todayEntries.length > 0 && (
                                <div className="space-y-2">
                                    {todayEntries.map(entry => (
                                        <div key={entry.id} className="flex items-center justify-between bg-white p-3 rounded border">
                                            <div className="flex-1 text-sm sm:text-base">
                                                <span className="font-medium text-blue-600">{entry.category}</span>
                                                <span className="mx-2 text-gray-500">•</span>
                                                <span className="text-gray-700">{entry.description}</span>
                                                <span className="mx-2 text-gray-500">•</span>
                                                <span className="font-medium">{entry.hours}h</span>
                                            </div>
                                            <button
                                                onClick={() => deleteEntry(entry.id)}
                                                className="text-red-500 hover:text-red-700 p-1 ml-2"
                                            >
                                                <Trash2 className="w-4 h-4" />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Historial de días trabajados */}
                    {workDates.length > 0 && (
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Work History</h2>
                            <div className="space-y-4">
                                {workDates.slice(0, 10).map(date => {
                                    const dayEntries = getEntriesForDate(date);
                                    const dayTotal = getTotalHoursForDate(date);
                                    
                                    return (
                                        <div key={date} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex flex-col sm:flex-row sm:items-center justify-between mb-3">
                                                <h3 className="font-semibold text-lg text-gray-800 mb-2 sm:mb-0">
                                                    {new Date(date + 'T00:00:00').toLocaleDateString('en-US', { 
                                                        weekday: 'long', 
                                                        year: 'numeric', 
                                                        month: 'long', 
                                                        day: 'numeric' 
                                                    })}
                                                </h3>
                                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                                    dayTotal === 8 ? 'bg-green-100 text-green-800' : 
                                                    dayTotal > 8 ? 'bg-red-100 text-red-800' : 
                                                    'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    {dayTotal}/8h
                                                </span>
                                            </div>
                                            
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                {dayEntries.map(entry => (
                                                    <div key={entry.id} className="text-sm text-gray-600 bg-gray-50 p-2 rounded">
                                                        <strong>{entry.category}</strong> {entry.description} <em>{entry.hours}h</em>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {workDates.length > 10 && (
                                    <div className="text-center text-gray-500 text-sm">
                                        Showing last 10 days. Use backup buttons to see full history.
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<TimeTracker />, document.getElementById('root'));
    </script>
</body>
</html>
